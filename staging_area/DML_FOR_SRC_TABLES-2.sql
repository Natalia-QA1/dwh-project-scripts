-- insert data from first dataset to source table
INSERT INTO sa_source_1.ext_table_1  
(DiscountPercentage,
  DiscountName,
  DeliveryCompanyID,
  DeliveryCompany,
  ProductID ,
  ProductName,
  StoreType,
  PostalCode,
  StoreCode,
  StoreAddress,
  InvoiceNo,
  DeliveryType,
  DiscountID,
  Description,
  Quantity,
  InvoiceDate,
  UnitPrice,
  CustomerID,
  Country,
  StoreCity,
  StoreRegion,
  CustomerName,
  CustomerSurname,
  CustomerBirthday,
  CustomerGender,
  CustomerPhone,
  CustomerEmail,
  CustomerIncome,
  ProductCategory,
  ProductSubcategory,
  Brand,
  SupplierID,
  Supplier,
  DeliveryID,
  CourierID,
  CourierName,
  CourierPhone,
  DiscountDescription,
  DiscountLimit,
  DiscountAdd,
  InvoiceLine,
  LineCost,
  TotalQuantity,
  TotalAmount,
  TotalAmount_After_Discount,
  is_processed)
SELECT  
  a.DiscountPercentage,
  a.DiscountName,
  a.DeliveryCompanyID,
  a.DeliveryCompany,
  a.productid ,
  a.ProductName,
  a.StoreType,
  a.PostalCode,
  a.StoreCode,
  a.StoreAddress,
  a.InvoiceNo,
  a.DeliveryType,
  a.DiscountID,
  a.Description,
  a.Quantity,
  a.InvoiceDate,
  a.UnitPrice,
  a.CustomerID,
  a.Country,
  a.StoreCity,
  a.StoreRegion,
  a.CustomerName,
  a.CustomerSurname,
  a.CustomerBirthday,
  a.CustomerGender,
  a.CustomerPhone,
  a.CustomerEmail,
  a.CustomerIncome,
  a.ProductCategory,
  a.ProductSubcategory,
  a.Brand,
  a.SupplierID,
  a.Supplier,
  a.DeliveryID,
  a.CourierID,
  a.CourierName,
  a.CourierPhone,
  a.DiscountDescription,
  a.DiscountLimit,
  a.DiscountAdd,
  a.InvoiceLine,
  a.LineCost,
  a.TotalQuantity,
  a.TotalAmount,
  a.TotalAmount_After_Discount,
  'N' --means that ROW IS NOT processed (to implement incremental loading)
FROM sa_source_1.source_1  a
WHERE  discountpercentage <> 'DiscountPercentage' AND --TO avoid HEADER loading
       NOT EXISTS (SELECT 1 FROM sa_source_1.ext_table_1);

COMMIT;
